<header>
  <mat-toolbar class="bg-blue-400! flex justify-between">
    <div class="flex items-center">
      <img *ngIf="authService.isLoggedIn"
           src="logo.jpg"
           alt="Logo"
           class="w-10 h-10 rounded-full bg-white p-1 shadow-sm object-cover cursor-pointer ml-2 transition-transform hover:scale-105"
           (click)="drawer.toggle()"
      >
    </div>

    <div *ngIf="authService.isLoggedIn" class="flex gap-3 items-center">
      <span routerLink="/profile" class="text-white cursor-pointer">
        {{ authService.authDetail?.email }}
      </span>

      <img [src]="authService.profileImage ?? 'default-avatar.png'"
           alt="User"
           class="w-8 h-8 rounded-full object-cover border border-white shadow-sm cursor-pointer"
           routerLink="/profile"
      >

      <button (click)="authService.logout()" mat-icon-button class="text-white">
        <mat-icon>logout</mat-icon>
      </button>
    </div>
  </mat-toolbar>
</header>

<mat-drawer-container class="">
  <mat-drawer #drawer class="w-[300px] bg-white shadow-lg" 
              [mode]="'side'" 
              [opened]="authService.isLoggedIn">
    
    <div class="flex flex-col items-center gap-4 text-blue-700 p-4">
      <mat-nav-list role="list">

        <!-- Dashboard -->
        <mat-list-item *ngIf="authService.hasRole('SuperAdmin') || authService.hasPermission('VIEW_DASHBOARD')">
          <a class="menu" routerLink="/">
            <mat-icon>insert_chart</mat-icon>
            Accueil
          </a>
        </mat-list-item>

        <!-- Gestion Chauffeurs -->
        <mat-list-item *ngIf="authService.hasRole('SuperAdmin') || authService.hasEntityAccess('CHAUFFEUR')">
          <a class="menu" routerLink="/drivers">
            <mat-icon>badge</mat-icon>
            Gestion des chauffeurs
          </a>
        </mat-list-item>

        <!-- Gestion Convoyeurs -->
        <mat-list-item *ngIf="authService.hasRole('SuperAdmin') || authService.hasEntityAccess('CONVOYEUR')">
          <a class="menu" routerLink="/convoyeurs">
            <mat-icon>groups</mat-icon>
            Gestion des convoyeurs
          </a>
        </mat-list-item>

        <!-- Gestion Véhicules -->
        <mat-list-item *ngIf="authService.hasRole('SuperAdmin') || authService.hasEntityAccess('TRUCK')">
          <a class="menu" routerLink="/trucks">
            <mat-icon>local_shipping</mat-icon>
            Gestion des véhicules
          </a>
        </mat-list-item>

        <!-- Commandes -->
        <mat-list-item *ngIf="authService.hasRole('SuperAdmin') || authService.hasEntityAccess('ORDER')">
          <a class="menu" routerLink="/orders">
            <mat-icon>inventory_2</mat-icon>
            Commandes
          </a>
        </mat-list-item>

        <!-- Voyages -->
        <mat-list-item *ngIf="authService.hasRole('SuperAdmin') || authService.hasEntityAccess('TRIP')">
          <a class="menu" routerLink="/trips">
            <mat-icon>route</mat-icon>
            Gestion des voyages
          </a>
        </mat-list-item>

        <mat-list-item *ngIf="authService.hasRole('SuperAdmin') || authService.hasEntityAccess('TRIP_HISTORY')">
          <a class="menu" routerLink="/historic-trips">
            <mat-icon>history</mat-icon>
            Historique des voyages
          </a>
        </mat-list-item>

        <!-- Gestion Utilisateurs -->
        <mat-expansion-panel *ngIf="authService.hasRole('SuperAdmin') || authService.hasEntityAccess('USER')" class="settings-panel">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon>people</mat-icon>
              Gestion des utilisateurs
            </mat-panel-title>
          </mat-expansion-panel-header>

          <mat-nav-list>
            <mat-list-item *ngIf="authService.hasPermission('VIEW_USERS')">
              <a class="menu submenu" routerLink="/user" routerLinkActive="active">
                <mat-icon>person</mat-icon>
                Utilisateurs
              </a>
            </mat-list-item>

            <mat-list-item *ngIf="authService.hasPermission('VIEW_ROLES')">
              <a class="menu submenu" routerLink="/roles" routerLinkActive="active">
                <mat-icon>groups</mat-icon>
                Groupes d'utilisateurs
              </a>
            </mat-list-item>

            <mat-list-item *ngIf="authService.hasPermission('VIEW_PERMISSIONS')">
              <a class="menu submenu" routerLink="/permissions" routerLinkActive="active">
                <mat-icon>vpn_key</mat-icon>
                Permissions
              </a>
            </mat-list-item>
          </mat-nav-list>
        </mat-expansion-panel>

        <!-- Clients -->
        <mat-list-item *ngIf="authService.hasRole('SuperAdmin') || authService.hasEntityAccess('CUSTOMER')">
          <a class="menu" routerLink="/customers">
            <mat-icon>manage_accounts</mat-icon>
            Gestion des clients
          </a>
        </mat-list-item>

        <!-- Fournisseurs carburant -->
        <mat-list-item *ngIf="authService.hasRole('SuperAdmin') || authService.hasEntityAccess('FUEL_VENDOR')">
          <a class="menu" routerLink="/fuel-vendors">
            <mat-icon>local_gas_station</mat-icon>
            Fournisseurs de carburant
          </a>
        </mat-list-item>

        <!-- Carburant -->
        <mat-list-item *ngIf="authService.hasRole('SuperAdmin') || authService.hasEntityAccess('FUEL')">
          <a class="menu" routerLink="/fuels">
            <mat-icon>factory</mat-icon>
            Gestion du carburant
          </a>
        </mat-list-item>

      </mat-nav-list>
    </div>
  </mat-drawer>

  <mat-drawer-content>
    <main class="min-h-screen bg-gray-100">
      <router-outlet></router-outlet>
    </main>
  </mat-drawer-content>
</mat-drawer-container>

<footer></footer>
