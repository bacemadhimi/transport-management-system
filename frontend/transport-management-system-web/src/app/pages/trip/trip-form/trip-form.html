<mat-card class="trip-form-card">
  <header class="trip-form-card__header">
    <div>
      <h2>{{ data.tripId ? 'Modifier voyage' : 'Ajouter voyage' }}</h2>
    </div>
  </header>

  <form [formGroup]="tripForm" (ngSubmit)="onSubmit()">
    <!-- Client (full width) -->
    <mat-form-field appearance="outline" class="trip-field trip-field--wide">
      <mat-label>Client</mat-label>
      <mat-select formControlName="customerId">
        <mat-option *ngFor="let customer of customers" [value]="customer.id">
          {{ customer.name }}
          <span *ngIf="customer.email" class="text-gray-500 text-sm">
            ({{ customer.email }})
          </span>
          <span *ngIf="customer.phone" class="text-gray-500 text-sm">
            - {{ customer.phone }}
          </span>
        </mat-option>
      </mat-select>
      <mat-error *ngIf="tripForm.get('customerId')?.hasError('required')">
        La sélection d'un client est obligatoire
      </mat-error>
    </mat-form-field>

    <!-- Dates -->
    <div class="trip-row">
     
      <mat-form-field appearance="outline" class="trip-field">
        <mat-label>Date de début</mat-label>
        <input
          matInput
          [matDatepicker]="startDatePicker"
          formControlName="tripStartDate"
          placeholder="Choisir la date de début"
        />
        <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #startDatePicker></mat-datepicker>
        <mat-error *ngIf="tripForm.get('tripStartDate')?.hasError('required')">
          La date de début est obligatoire
        </mat-error>
      </mat-form-field>

      
      <mat-form-field appearance="outline" class="trip-field">
        <mat-label>Date de fin</mat-label>
        <input
          matInput
          [matDatepicker]="endDatePicker"
          formControlName="tripEndDate"
          placeholder="Choisir la date de fin"
        />
        <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #endDatePicker></mat-datepicker>
        <mat-error *ngIf="tripForm.get('tripEndDate')?.hasError('required')">
          La date de fin est obligatoire
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Type & camion -->
    <div class="trip-row">
      <mat-form-field appearance="outline" class="trip-field">
        <mat-label>Type de voyage</mat-label>
        <mat-select formControlName="tripType" placeholder="Sélectionner un type">
          <mat-option *ngFor="let type of tripTypes" [value]="type.value">
            {{ type.label }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="tripForm.get('tripType')?.hasError('required')">
          Le type de voyage est obligatoire
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="trip-field">
        <mat-label>Camion</mat-label>
        <mat-select formControlName="truckId" placeholder="Sélectionner un camion">
          <mat-option *ngFor="let truck of trucks" [value]="truck.id">
            {{ truck.immatriculation }} - {{ truck.brand }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="tripForm.get('truckId')?.hasError('required')">
          La sélection d'un camion est obligatoire
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Chauffeur & statut -->
    <div class="trip-row">
      <mat-form-field appearance="outline" class="trip-field">
        <mat-label>Chauffeur</mat-label>
        <mat-select formControlName="driverId" placeholder="Sélectionner un chauffeur">
          <mat-option *ngFor="let driver of drivers" [value]="driver.id">
            {{ driver.name }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="tripForm.get('driverId')?.hasError('required')">
          La sélection d'un chauffeur est obligatoire
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="trip-field">
        <mat-label>Statut du voyage</mat-label>
        <mat-select formControlName="tripStatus" placeholder="Sélectionner un statut">
          <mat-option *ngFor="let status of tripStatuses" [value]="status.value">
            {{ status.label }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="tripForm.get('tripStatus')?.hasError('required')">
          Le statut du voyage est obligatoire
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Lieux -->
    <div class="trip-row">
      <mat-form-field appearance="outline" class="trip-field">
        <mat-label>Lieu de départ</mat-label>
        <input
          matInput
          formControlName="tripStartLocation"
          placeholder="Ex: Tunis"
        />
        <mat-error *ngIf="tripForm.get('tripStartLocation')?.hasError('required')">
          Le lieu de départ est obligatoire
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="trip-field">
        <mat-label>Lieu d'arrivée</mat-label>
        <input
          matInput
          formControlName="tripEndLocation"
          placeholder="Ex: Sfax"
        />
        <mat-error *ngIf="tripForm.get('tripEndLocation')?.hasError('required')">
          Le lieu d'arrivée est obligatoire
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Distance & kilométrage -->
    <div class="trip-row">
      <mat-form-field appearance="outline" class="trip-field">
        <mat-label>Distance approximative (KM)</mat-label>
        <input
          matInput
          type="number"
          formControlName="approxTotalKM"
          min="0"
          step="0.1"
          placeholder="Ex: 250"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="trip-field">
        <mat-label>Kilométrage de départ</mat-label>
        <input
          matInput
          type="number"
          formControlName="startKmsReading"
          placeholder="Ex: 102345"
        />
        <mat-error *ngIf="tripForm.get('startKmsReading')?.hasError('required')">
          Le kilométrage de départ est obligatoire
        </mat-error>
        <mat-error *ngIf="tripForm.get('startKmsReading')?.hasError('min')">
          Le kilométrage doit être positif
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Footer -->
    <div class="form-footer">
      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="tripForm.invalid"
      >
        {{ data.tripId ? 'Enregistrer' : 'Ajouter' }}
      </button>
      <button mat-button type="button" (click)="onCancel()">Annuler</button>
    </div>
  </form>
</mat-card>