<div class="availability-page">
  <div class="availability-header">
    <h1 class="availability-title">Disponibilit√© des Chauffeurs</h1>

    <div class="availability-header__actions">
      <div class="availability-header__left">
        <mat-form-field appearance="outline" class="availability-search">
          <mat-label>Rechercher chauffeur</mat-label>
          <input
            matInput
            type="text"
            [formControl]="searchControl"
            placeholder="Nom, permis, t√©l√©phone"
          />
        </mat-form-field>

        <div class="week-navigation">
          <button mat-icon-button (click)="previousWeek()" [disabled]="selectedWeekIndex === 0">
            <mat-icon>chevron_left</mat-icon>
          </button>
          
          <mat-form-field appearance="outline" class="week-selector">
            <mat-select [value]="selectedWeekIndex" (selectionChange)="goToWeek($event.value)">
              @for (week of weeks; track $index; let i = $index) {
                <mat-option [value]="i">{{ week.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
          
          <button mat-icon-button (click)="nextWeek()" [disabled]="selectedWeekIndex === weeks.length - 1">
            <mat-icon>chevron_right</mat-icon>
          </button>
          
          <button mat-button (click)="goToToday()" class="today-btn">
            <mat-icon>today</mat-icon>
            Aujourd'hui
          </button>
        </div>

        <div class="export-actions" aria-label="Export actions">
          <button mat-icon-button class="export-btn export-excel" (click)="exportExcel()" title="Export Excel">
            <svg viewBox="0 0 24 24" class="export-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <rect x="2" y="3" width="20" height="18" rx="2" fill="#107C10"></rect>
              <text x="12" y="16" text-anchor="middle" font-size="10" font-weight="700" fill="#fff">XLS</text>
            </svg>
          </button>

          <button mat-icon-button class="export-btn export-csv" (click)="exportCSV()" title="Export CSV">
            <svg viewBox="0 0 24 24" class="export-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <rect x="2" y="3" width="20" height="18" rx="2" fill="#1E90FF"></rect>
              <text x="12" y="16" text-anchor="middle" font-size="9" font-weight="700" fill="#fff">CSV</text>
            </svg>
          </button>

          <button mat-icon-button class="export-btn export-pdf" (click)="exportPDF()" title="Export PDF">
            <svg viewBox="0 0 24 24" class="export-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <rect x="2" y="3" width="20" height="18" rx="2" fill="#D32F2F"></rect>
              <text x="12" y="16" text-anchor="middle" font-size="9" font-weight="700" fill="#fff">PDF</text>
            </svg>
          </button>
        </div>
      </div>
      
      <div class="availability-header__right">
        <div class="availability-stats">
          <div class="stat-badge available">
            <span class="stat-icon">‚úÖ</span>
            <span class="stat-text">Disponible</span>
            <span class="stat-hint">(cliquez pour changer)</span>
          </div>
          <div class="stat-badge unavailable">
            <span class="stat-icon">‚ùå</span>
            <span class="stat-text">Indisponible</span>
            <span class="stat-hint">(cliquez pour changer)</span>
          </div>
          <div class="stat-badge weekend">
            <span class="stat-icon">üå¥</span>
            <span class="stat-text">Weekend</span>
            <span class="stat-hint">(non modifiable)</span>
          </div>
          <div class="stat-badge holiday">
            <span class="stat-icon">üéâ</span>
            <span class="stat-text">F√©ri√©</span>
            <span class="stat-hint">(non modifiable)</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="instructions">
    <p><strong>Instructions :</strong> Cliquez sur ‚úÖ pour changer en ‚ùå (indisponible).</p>
    <p class="note">Note : Les weekends (üå¥) et jours f√©ri√©s (üéâ) ne peuvent pas √™tre modifi√©s.</p>
  </div>

  
  <div class="table-container">
    <div class="availability-table-wrapper">
    
      <div class="pagination-controls" *ngIf="hasPagedData">
        <div class="pagination-info">
          Affichage de {{ getStartIndex() + 1 }} √† {{ getEndIndex() }} sur {{ pagedDriverData.totalData }} chauffeurs
        </div>
        <div class="pagination-buttons">
          <button mat-icon-button (click)="previousPage()" [disabled]="filter.pageIndex === 0">
            <mat-icon>chevron_left</mat-icon>
          </button>
          <span class="page-number">Page {{filter.pageIndex + 1}} sur {{getTotalPages()}}</span>
          <button mat-icon-button (click)="nextPage()" [disabled]="isLastPage()">
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>
      </div>

      <div class="table-scroll-wrapper">
        <table class="availability-table">
          <thead>
            <tr>
              <th class="sticky-col">Nom</th>
             
              <th *ngFor="let dateCol of dateColumns" class="date-header">
                <div class="date-cell">
                  <div class="date-label">{{dateCol.label}}</div>
                  <div class="day-label">{{dateCol.dayOfWeek}}</div>
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
           <tr *ngFor="let driver of getCurrentPageData(); let i = index">
              <td class="sticky-col driver-info">
                <div class="driver-name">{{driver.name}}</div>
                <div class="driver-phone">{{driver.phone}}</div>
              </td>
             
              <td *ngFor="let dateCol of dateColumns; let i = index" 
                  (click)="onCellClick(driver.id, i)"
                  [ngClass]="getCellClasses(driver, dateCol)">
                <div class="availability-cell">
                  <span class="availability-emoji">{{getAvailabilityEmoji(driver, dateCol)}}</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      
      <div class="empty-state" *ngIf="pagedDriverData?.data?.length === 0">
        <mat-icon>person_off</mat-icon>
        <p>Aucun chauffeur trouv√©</p>
      </div>
    </div>
  </div>
</div>