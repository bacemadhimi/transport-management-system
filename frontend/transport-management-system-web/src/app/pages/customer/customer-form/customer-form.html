<div class="scroll-container">
  <mat-card class="form-card p-8">
    <mat-card-title>
      {{ isEditing ? 'Modifier Client' : 'Ajouter Client' }}
    </mat-card-title>

    <form [formGroup]="customerForm" (ngSubmit)="onSubmit()">
            <!-- Matricule -->
      <mat-form-field class="w-full">
        <mat-label>Matricule</mat-label>
        <input matInput formControlName="matricule" placeholder="Ex : MAT-00123" [readonly]="isSubmitting || loadingZones">
        <mat-error *ngIf="customerForm.get('matricule')?.invalid && customerForm.get('matricule')?.touched">
          {{ getErrorMessage('matricule') }}
        </mat-error>
      </mat-form-field>

      <!-- Full Name -->
      <mat-form-field class="w-full">
        <mat-label>Nom Complet</mat-label>
        <input matInput formControlName="name" placeholder="e.g., Monoprix" [readonly]="isSubmitting || loadingZones">
        <mat-error *ngIf="customerForm.get('name')?.invalid && customerForm.get('name')?.touched">
          {{ getErrorMessage('name') }}
        </mat-error>
      </mat-form-field>



      <!-- Phone -->
      <mat-label>Téléphone</mat-label>
      <div class="mat-phone-field w-full">
        <div class="mat-phone-wrapper">
          <input matInput formControlName="phone" #phoneInput [readonly]="isSubmitting || loadingZones" />
        </div>
        <mat-error *ngIf="customerForm.get('phone')?.invalid && customerForm.get('phone')?.touched">
          {{ getErrorMessage('phone') }}
        </mat-error>
      </div>

      <!-- Email -->
      <mat-form-field class="w-full">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" placeholder="e.g., jean.dupont@example.com" [readonly]="isSubmitting || loadingZones">
        <mat-error *ngIf="customerForm.get('email')?.invalid && customerForm.get('email')?.touched">
          {{ getErrorMessage('email') }}
        </mat-error>
      </mat-form-field>

      <!-- Address -->
      <mat-form-field class="w-full">
        <mat-label>Adresse</mat-label>
        <textarea matInput formControlName="adress" placeholder="e.g., 123 Rue Principale, Paris, France" [readonly]="isSubmitting || loadingZones" rows="3"></textarea>
        <mat-error *ngIf="customerForm.get('adress')?.invalid && customerForm.get('adress')?.touched">
          {{ getErrorMessage('adress') }}
        </mat-error>
      </mat-form-field>

      <!-- Governorate -->
      <!-- <mat-form-field class="w-full">
        <mat-label>Gouvernorat</mat-label>
        <textarea matInput formControlName="gouvernorat" placeholder="gouvernorat" [readonly]="isSubmitting || loadingZones" rows="3"></textarea>
        <mat-error *ngIf="customerForm.get('gouvernorat')?.invalid && customerForm.get('gouvernorat')?.touched">
          {{ getErrorMessage('gouvernorat') }}
        </mat-error>
      </mat-form-field> -->

      <!-- <mat-form-field class="w-full">
        <mat-label>City</mat-label>
        <textarea matInput formControlName="city" placeholder="ville" [readonly]="isSubmitting || loadingZones" rows="3"></textarea>
        <mat-error *ngIf="customerForm.get('city')?.invalid && customerForm.get('city')?.touched">
          {{ getErrorMessage('city') }}
        </mat-error>
      </mat-form-field> -->
      <!-- Contact -->
      <mat-form-field class="w-full">
        <mat-label>Contact</mat-label>
        <textarea matInput formControlName="contact" placeholder="contact" [readonly]="isSubmitting || loadingZones" rows="3"></textarea>
        <mat-error *ngIf="customerForm.get('contact')?.invalid && customerForm.get('contact')?.touched">
          {{ getErrorMessage('contact') }}
        </mat-error>
      </mat-form-field>

      <!-- Zone Dropdown (REPLACED TEXTAREA WITH SELECT) -->
      <mat-form-field class="w-full">
        <mat-label>Zone</mat-label>
        <mat-select 
          formControlName="zoneId" 
          [disabled]="isSubmitting || loadingZones"
          required
        >
          <!-- Loading state -->
          <mat-option *ngIf="loadingZones" disabled>
            <div class="flex items-center">
              <mat-spinner diameter="20" class="mr-2"></mat-spinner>
              <span>Chargement des zones...</span>
            </div>
          </mat-option>
          
          <!-- No zones available -->
          <mat-option *ngIf="!loadingZones && zones.length === 0" disabled>
            <div class="text-gray-500 italic">
              Aucune zone active disponible
            </div>
          </mat-option>
          
          <!-- Zones list -->
          <mat-option *ngFor="let zone of zones" [value]="zone.id">
            {{ zone.name }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="customerForm.get('zoneId')?.invalid && customerForm.get('zoneId')?.touched">
          {{ getErrorMessage('zoneId') }}
        </mat-error>
      </mat-form-field>
         
      <!-- City Dropdown -->
<mat-form-field class="w-full">
  <mat-label>City</mat-label>
  <mat-select 
    formControlName="cityId"
    [disabled]="isSubmitting || loadingCities"
    required
  >
    <!-- Loading state -->
    <mat-option *ngIf="loadingCities" disabled>
      <div class="flex items-center">
        <mat-spinner diameter="20" class="mr-2"></mat-spinner>
        <span>Chargement des villes...</span>
      </div>
    </mat-option>

    <!-- No cities available -->
    <mat-option *ngIf="!loadingCities && cities.length === 0" disabled>
      <div class="text-gray-500 italic">Aucune ville active disponible</div>
    </mat-option>

    <!-- Cities list -->
    <mat-option *ngFor="let city of cities" [value]="city.id">
      {{ city.name }}
    </mat-option>
  </mat-select>

  <mat-error *ngIf="customerForm.get('cityId')?.invalid && customerForm.get('cityId')?.touched">
    {{ getErrorMessage('cityId') }}
  </mat-error>
</mat-form-field>

      <!-- Form Buttons -->
      <div class="flex justify-center mt-4 space-x-4">
        <button 
          mat-raised-button 
          color="primary" 
          type="submit" 
          [disabled]="customerForm.invalid || isSubmitting || loadingZones"
        >
          <mat-spinner *ngIf="isSubmitting" diameter="20" class="inline-block mr-2"></mat-spinner>
          {{ isEditing ? 'Modifier' : 'Ajouter' }}
        </button>

        <button mat-button type="button" (click)="onCancel()" [disabled]="isSubmitting">
          Annuler
        </button>
      </div>
    </form>
  </mat-card>
</div>